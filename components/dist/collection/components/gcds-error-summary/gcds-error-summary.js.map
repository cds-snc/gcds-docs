{"version":3,"file":"gcds-error-summary.js","sourceRoot":"","sources":["../../../../src/components/gcds-error-summary/gcds-error-summary.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  Component,\n  Host,\n  Element,\n  Prop,\n  Watch,\n  State,\n  Listen,\n  Event,\n  EventEmitter,\n  h,\n} from '@stencil/core';\nimport { assignLanguage, observerConfig } from '../../utils/utils';\nimport i18n from './i18n/i18n';\n\n/**\n * An error summary is a list of user errors in a form.\n */\n@Component({\n  tag: 'gcds-error-summary',\n  styleUrl: 'gcds-error-summary.css',\n  shadow: true,\n})\nexport class GcdsErrorSummary {\n  @Element() el: HTMLElement;\n\n  private shadowElement?: HTMLElement;\n\n  /**\n   * Set error summary heading\n   */\n  @Prop({ reflect: true }) heading?: string;\n\n  /**\n   * Specifies if the error summary should listen for GcdsError event to generate error list.\n   */\n  @Prop({ mutable: true }) listen?: boolean = true;\n  @Watch('listen')\n  listenChanged() {\n    if (this.errorLinks) {\n      this.listen = false;\n    }\n  }\n\n  /**\n   * Object of list items for error list. Format: { link-href: link-label }\n   */\n  @Prop({ reflect: false, mutable: true }) errorLinks: string | object;\n  errorLinksObject: object = {};\n\n  /**\n   * Convert contextual links prop to object\n   * (Object props get treated as string when using Stencil components without a framework)\n   */\n  @Watch('errorLinks')\n  errorLinksChanged(newErrorLinks: string | object) {\n    if (typeof newErrorLinks == 'string') {\n      this.errorLinks = JSON.parse(newErrorLinks);\n    } else if (typeof newErrorLinks == 'object') {\n      this.errorLinks = newErrorLinks;\n    }\n\n    this.errorQueue = this.errorLinks as Object;\n\n    // Turn off listen if error-links is being used\n    if (this.listen) {\n      this.listen = false;\n    }\n  }\n\n  /**\n   * Events\n   */\n\n  /**\n   * Emitted when the link has focus.\n   */\n  @Event() gcdsFocus!: EventEmitter<void>;\n\n  /**\n   * Emitted when the link loses focus.\n   */\n  @Event() gcdsBlur!: EventEmitter<void>;\n\n  /**\n   * Emitted when the link has been clicked.\n   */\n  @Event() gcdsClick!: EventEmitter<string>;\n\n  /**\n   * Language of rendered component\n   */\n  @State() lang: string;\n\n  /**\n   * Queue of erros\n   */\n  @State() errorQueue: object = {};\n\n  @State() hasSubmitted: boolean = false;\n\n  @Listen('gcdsError', { target: 'document' })\n  errorListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      this.errorLinksObject[e.detail.message] = e.target;\n    }\n  }\n\n  @Listen('gcdsValid', { target: 'document' })\n  validListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      for (const [key, value] of Object.entries(this.errorLinksObject)) {\n        if (value == e.target) {\n          delete this.errorLinksObject[key];\n        }\n      }\n\n      if (this.errorQueue) {\n        const sortedErrorList = this.sortErrors();\n\n        this.errorQueue = { ...sortedErrorList };\n      }\n    }\n  }\n\n  @Listen('submit', { target: 'document' })\n  submitListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      this.hasSubmitted = true;\n\n      // Time out to collect gcdsError events before rendering\n      setTimeout(() => {\n        const sortedErrorList = this.sortErrors();\n\n        this.errorQueue = { ...sortedErrorList };\n\n        // Time out to let list render\n        setTimeout(() => {\n          this.shadowElement.focus();\n        }, 50);\n      }, 100);\n    }\n  }\n\n  /*\n   * Sort error object based on the order form compoennts appear in the form\n   */\n  sortErrors() {\n    const sortable = Object.entries(this.errorLinksObject).map(\n      ([key, value]) => [\n        key,\n        value,\n        (value as HTMLElement).getBoundingClientRect().y,\n      ],\n    );\n\n    sortable.sort(function (a, b) {\n      return a[2] - b[2];\n    });\n\n    const objSorted = {};\n    sortable.forEach(function (item) {\n      objSorted[item[0]] = item[1];\n    });\n\n    return objSorted;\n  }\n\n  /*\n   * Focus element on error link click with label visible\n   */\n  focusElement(id) {\n    const element = document.querySelector(id);\n\n    const target = `[for=${id.replace('#', '')}]`;\n\n    element.closest('form').querySelector(target)?.scrollIntoView();\n    element.focus();\n  }\n\n  /*\n   * Observe lang attribute change\n   */\n  updateLang() {\n    const observer = new MutationObserver(mutations => {\n      if (mutations[0].oldValue != this.el.lang) {\n        this.lang = this.el.lang;\n      }\n    });\n    observer.observe(this.el, observerConfig);\n  }\n\n  async componentWillLoad() {\n    // Define lang attribute\n    this.lang = assignLanguage(this.el);\n\n    this.updateLang();\n    this.listenChanged();\n\n    // Format error-links string / object\n    if (this.errorLinks && typeof this.errorLinks == 'string') {\n      this.errorQueue = { ...JSON.parse(this.errorLinks) };\n    } else if (this.errorLinks && typeof this.errorLinks == 'object') {\n      this.errorQueue = { ...this.errorLinks };\n    }\n  }\n\n  render() {\n    const { heading, errorQueue, lang, hasSubmitted, errorLinks } = this;\n    return (\n      <Host>\n        <div\n          role=\"alert\"\n          tabindex=\"-1\"\n          ref={element => (this.shadowElement = element as HTMLElement)}\n          class={`gcds-error-summary ${\n            (hasSubmitted || errorLinks) && Object.keys(errorQueue).length > 0\n              ? 'gcds-show'\n              : ''\n          }`}\n        >\n          <gcds-heading tag=\"h2\" margin-top=\"0\" margin-bottom=\"225\">\n            {heading ?? i18n[lang].heading}\n          </gcds-heading>\n          <ol class=\"summary__errorlist\">\n            {(hasSubmitted || errorLinks) &&\n              Object.keys(errorQueue).length > 0 &&\n              Object.keys(errorQueue).map(key => {\n                return (\n                  <li class=\"summary__listitem\">\n                    <gcds-link\n                      size=\"regular\"\n                      href={errorLinks ? key : '#'}\n                      onClick={e => {\n                        e.preventDefault();\n                        errorLinks\n                          ? this.focusElement(key)\n                          : (errorQueue[key] as HTMLElement).focus();\n                      }}\n                    >\n                      {errorLinks ? errorQueue[key] : key}\n                    </gcds-link>\n                  </li>\n                );\n              })}\n          </ol>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}