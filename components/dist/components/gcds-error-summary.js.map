{"file":"gcds-error-summary.js","mappings":"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","names":["GcdsErrorSummary","i18n"],"sources":["src/components/gcds-error-summary/i18n/i18n.js","src/components/gcds-error-summary/gcds-error-summary.css?tag=gcds-error-summary&encapsulation=shadow","src/components/gcds-error-summary/gcds-error-summary.tsx"],"sourcesContent":["const I18N = {\n  en: {\n    heading: 'There was a problem',\n    subheading: 'Errors were found on this page:',\n  },\n  fr: {\n    heading: 'Un problème est survenu',\n    subheading: 'Des erreurs ont été trouvées sur cette page :',\n  },\n};\n\nexport default I18N;\n","@layer reset, default, compact;\n\n@layer reset {\n  :host {\n    display: block;\n  }\n}\n\n@layer default {\n  :host {\n    container: component summary / inline-size;\n\n    .gcds-error-summary {\n      padding: var(--gcds-error-summary-padding);\n      margin: var(--gcds-error-summary-margin);\n      border: var(--gcds-error-summary-border-width) solid\n        var(--gcds-error-summary-border-color);\n      color: var(--gcds-error-summary-text);\n      transition:\n        background 0.15s ease-in-out,\n        border 0.15s ease-in-out,\n        color 0.15s ease-in-out;\n      display: none;\n\n      &.gcds-show {\n        display: block;\n      }\n\n      .summary__errorlist {\n        padding: 0;\n        margin: var(--gcds-error-summary-list-margin);\n\n        .summary__listitem {\n          max-width: var(--gcds-error-summary-max-width);\n\n          &:not(:last-child) {\n            padding: var(--gcds-error-summary-list-item-padding);\n          }\n\n          gcds-link::part(link):not(:focus) {\n            color: var(--gcds-error-summary-link-color);\n          }\n        }\n      }\n    }\n  }\n}\n\n@layer compact {\n  @container summary (width < 24em) {\n    :host .gcds-error-summary {\n      padding: var(--gcds-error-summary-mobile-padding);\n    }\n  }\n}\n","import {\n  Component,\n  Host,\n  Element,\n  Prop,\n  Watch,\n  State,\n  Listen,\n  h,\n} from '@stencil/core';\nimport { assignLanguage, observerConfig } from '../../utils/utils';\nimport i18n from './i18n/i18n';\n\n@Component({\n  tag: 'gcds-error-summary',\n  styleUrl: 'gcds-error-summary.css',\n  shadow: true,\n})\nexport class GcdsErrorSummary {\n  @Element() el: HTMLElement;\n\n  private shadowElement?: HTMLElement;\n\n  /**\n   * Set error summary heading\n   */\n  @Prop({ reflect: true }) heading?: string;\n\n  /**\n   * Specifies if the error summary should listen for GcdsError event to generate error list.\n   */\n  @Prop({ mutable: true }) listen?: boolean = true;\n  @Watch('listen')\n  listenChanged() {\n    if (this.errorLinks) {\n      this.listen = false;\n    }\n  }\n\n  /**\n   * Object of list items for error list. Format: { link-href: link-label }\n   */\n  @Prop({ reflect: false, mutable: true }) errorLinks: string | object;\n  errorLinksObject: object = {};\n\n  /**\n   * Convert contextual links prop to object\n   * (Object props get treated as string when using Stencil components without a framework)\n   */\n  @Watch('errorLinks')\n  errorLinksChanged(newErrorLinks: string | object) {\n    if (typeof newErrorLinks == 'string') {\n      this.errorLinks = JSON.parse(newErrorLinks);\n    } else if (typeof newErrorLinks == 'object') {\n      this.errorLinks = newErrorLinks;\n    }\n\n    this.errorQueue = this.errorLinks as Object;\n\n    // Turn off listen if error-links is being used\n    if (this.listen) {\n      this.listen = false;\n    }\n  }\n\n  /**\n   * Language of rendered component\n   */\n  @State() lang: string;\n\n  /**\n   * Queue of erros\n   */\n  @State() errorQueue: object = {};\n\n  @State() hasSubmitted: boolean = false;\n\n  @Listen('gcdsError', { target: 'document' })\n  errorListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      this.errorLinksObject[e.detail.message] = e.target;\n    }\n  }\n\n  @Listen('gcdsValid', { target: 'document' })\n  validListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      for (const [key, value] of Object.entries(this.errorLinksObject)) {\n        if (value == e.target) {\n          delete this.errorLinksObject[key];\n        }\n      }\n\n      if (this.errorQueue) {\n        const sortedErrorList = this.sortErrors();\n\n        this.errorQueue = { ...sortedErrorList };\n      }\n    }\n  }\n\n  @Listen('submit', { target: 'document' })\n  submitListener(e) {\n    if (this.listen && e.target.closest('form') == this.el.closest('form')) {\n      this.hasSubmitted = true;\n\n      // Time out to collect gcdsError events before rendering\n      setTimeout(() => {\n        const sortedErrorList = this.sortErrors();\n\n        this.errorQueue = { ...sortedErrorList };\n\n        // Time out to let list render\n        setTimeout(() => {\n          this.shadowElement.focus();\n        }, 50);\n      }, 100);\n    }\n  }\n\n  /*\n   * Sort error object based on the order form compoennts appear in the form\n   */\n  sortErrors() {\n    const sortable = Object.entries(this.errorLinksObject).map(\n      ([key, value]) => [\n        key,\n        value,\n        (value as HTMLElement).getBoundingClientRect().y,\n      ],\n    );\n\n    sortable.sort(function (a, b) {\n      return a[2] - b[2];\n    });\n\n    const objSorted = {};\n    sortable.forEach(function (item) {\n      objSorted[item[0]] = item[1];\n    });\n\n    return objSorted;\n  }\n\n  /*\n   * Focus element on error link click with label visible\n   */\n  focusElement(id) {\n    const element = document.querySelector(id);\n\n    let target = `[for=${id.replace('#', '')}]`;\n\n    if (element.nodeName == 'FIELDSET') {\n      target = `#legend-${id.replace('#', '')}`;\n    }\n\n    element.closest('form').querySelector(target).scrollIntoView();\n    element.focus();\n  }\n\n  /*\n   * Observe lang attribute change\n   */\n  updateLang() {\n    const observer = new MutationObserver(mutations => {\n      if (mutations[0].oldValue != this.el.lang) {\n        this.lang = this.el.lang;\n      }\n    });\n    observer.observe(this.el, observerConfig);\n  }\n\n  async componentWillLoad() {\n    // Define lang attribute\n    this.lang = assignLanguage(this.el);\n\n    this.updateLang();\n    this.listenChanged();\n\n    // Format error-links string / object\n    if (this.errorLinks && typeof this.errorLinks == 'string') {\n      this.errorQueue = { ...JSON.parse(this.errorLinks) };\n    } else if (this.errorLinks && typeof this.errorLinks == 'object') {\n      this.errorQueue = { ...this.errorLinks };\n    }\n  }\n\n  render() {\n    const { heading, errorQueue, lang, hasSubmitted, errorLinks } = this;\n    return (\n      <Host>\n        <div\n          role=\"alert\"\n          tabindex=\"-1\"\n          ref={element => (this.shadowElement = element as HTMLElement)}\n          class={`gcds-error-summary ${\n            (hasSubmitted || errorLinks) && Object.keys(errorQueue).length > 0\n              ? 'gcds-show'\n              : ''\n          }`}\n        >\n          <gcds-heading tag=\"h2\" margin-top=\"0\" margin-bottom=\"300\">\n            {heading ?? i18n[lang].heading}\n          </gcds-heading>\n          <ol class=\"summary__errorlist\">\n            {(hasSubmitted || errorLinks) &&\n              Object.keys(errorQueue).length > 0 &&\n              Object.keys(errorQueue).map(key => {\n                return (\n                  <li class=\"summary__listitem\">\n                    <gcds-link\n                      size=\"regular\"\n                      href={errorLinks ? key : '#'}\n                      onClick={e => {\n                        e.preventDefault();\n                        errorLinks\n                          ? this.focusElement(key)\n                          : (errorQueue[key] as HTMLElement).focus();\n                      }}\n                    >\n                      {errorLinks ? errorQueue[key] : key}\n                    </gcds-link>\n                  </li>\n                );\n              })}\n          </ol>\n        </div>\n      </Host>\n    );\n  }\n}\n"],"version":3}